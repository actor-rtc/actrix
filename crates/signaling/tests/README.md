# Signaling æœåŠ¡æµ‹è¯•è®¡åˆ’

**çŠ¶æ€**: ğŸŸ¢ P0 æ ¸å¿ƒé€»è¾‘æµ‹è¯•å·²å®Œæˆ
**ä¼˜å…ˆçº§**: P0 æ ¸å¿ƒå®Œæˆï¼ŒP1 é›†æˆæµ‹è¯•å¾…å®æ–½
**å½“å‰è¿›å±•**: æ ¸å¿ƒæ¨¡å—å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 70%ï¼Œå…± 54 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## æµ‹è¯•ç­–ç•¥

### é˜¶æ®µ 1: åŸºç¡€åŠŸèƒ½éªŒè¯ (å½“å‰é˜¶æ®µ)

ç”±äºå®Œæ•´çš„ WebSocket + protobuf é›†æˆæµ‹è¯•éœ€è¦ï¼š
1. æ­£ç¡®çš„ `ActrToSignaling` protobuf ç»“æ„ï¼ˆéœ€è¦ `source` + `credential` + `payload` oneofï¼‰
2. WebSocket å®¢æˆ·ç«¯åº“ (`tokio-tungstenite`)
3. å®Œæ•´çš„ Actor ID å’Œ Credential ç”Ÿæˆæµç¨‹

æˆ‘ä»¬é‡‡ç”¨**åˆ†é˜¶æ®µæµ‹è¯•ç­–ç•¥**ï¼š

#### âœ… å·²å®Œæˆï¼ˆP0ï¼‰
- æ¨¡å—ç¼–è¯‘é€šè¿‡
- ç±»å‹ç³»ç»Ÿæ­£ç¡®
- æ—  Clippy è­¦å‘Š
- âœ… è´Ÿè½½å‡è¡¡ç®—æ³•å•å…ƒæµ‹è¯•ï¼ˆ23 ä¸ªæµ‹è¯•ï¼‰
- âœ… æœåŠ¡æ³¨å†Œè¡¨å•å…ƒæµ‹è¯•ï¼ˆ14 ä¸ªæµ‹è¯•ï¼‰
- âœ… å…¼å®¹æ€§ç¼“å­˜å•å…ƒæµ‹è¯•ï¼ˆ5 ä¸ªæµ‹è¯•ï¼‰
- âœ… åœ°ç†è·ç¦»è®¡ç®—æµ‹è¯•ï¼ˆ5 ä¸ªæµ‹è¯•ï¼‰
- âœ… Presence ç®¡ç†æµ‹è¯•ï¼ˆ5 ä¸ªæµ‹è¯•ï¼‰
- âœ… AIS å®¢æˆ·ç«¯é…ç½®æµ‹è¯•ï¼ˆ2 ä¸ªæµ‹è¯•ï¼‰

#### â³ å¾…å®æ–½ï¼ˆP1ï¼‰
- å®Œæ•´çš„ WebSocket é›†æˆæµ‹è¯•
- ç«¯åˆ°ç«¯ä¿¡ä»¤æµç¨‹æµ‹è¯•
- è´Ÿè½½æµ‹è¯•å’Œå¹¶å‘æµ‹è¯•

---

## å¿…éœ€çš„æµ‹è¯•ç”¨ä¾‹

### 1. WebSocket è¿æ¥æµ‹è¯• â³

**åŠŸèƒ½**: éªŒè¯ WebSocket æ¡æ‰‹å’Œè¿æ¥ä¿æŒ

**æµ‹è¯•ç‚¹**:
- âœ… æˆåŠŸè¿æ¥å’Œæ¡æ‰‹ï¼ˆé€šè¿‡æ‰‹åŠ¨æµ‹è¯•éªŒè¯ï¼‰
- â³ è®¤è¯å¤±è´¥åœºæ™¯
- â³ è¿æ¥è¶…æ—¶å¤„ç†
- â³ ä¼˜é›…æ–­å¼€

**å®ç°å¤æ‚åº¦**: é«˜ï¼ˆéœ€è¦ WebSocket å®¢æˆ·ç«¯ï¼‰

---

### 2. Actor æ³¨å†Œæµ‹è¯• â³

**åŠŸèƒ½**: éªŒè¯ Actor æ³¨å†Œæµç¨‹

**åè®®ç»“æ„**:
```rust
// å®¢æˆ·ç«¯å‘é€
SignalingEnvelope {
    flow: PeerToSignaling(RegisterRequest {
        actr_type: ActrType { manufacturer, name },
        realm: Realm { realm_id },
        service_spec: Option,
        acl: Option,
    })
}

// æœåŠ¡å™¨å“åº”
SignalingEnvelope {
    flow: SignalingToActr(RegisterResponse {
        result: Success {
            actr_id: ActrId,
            credential: AIdCredential,
            psk: Option<Bytes>,
            credential_expires_at: Timestamp,
            signaling_heartbeat_interval_secs: u32,
        }
    })
}
```

**æµ‹è¯•ç‚¹**:
- â³ æ­£å¸¸æ³¨å†Œæµç¨‹
- â³ é‡å¤æ³¨å†Œå¤„ç†
- â³ Credential éªŒè¯ï¼ˆå¦‚æœå¯ç”¨ï¼‰
- â³ æ³¨é”€æ¸…ç†

**å®ç°å¤æ‚åº¦**: é«˜ï¼ˆéœ€è¦ AIS é›†æˆæˆ– mockï¼‰

---

### 3. å¿ƒè·³æœºåˆ¶æµ‹è¯• â³

**åŠŸèƒ½**: éªŒè¯ Ping/Pong å¿ƒè·³

**åè®®ç»“æ„**:
```rust
// å®¢æˆ·ç«¯å‘é€
ActrToSignaling {
    source: ActrId,
    credential: AIdCredential,
    payload: Ping {
        availability: ServiceAvailabilityState,
        power_reserve: f32,
        mailbox_backlog: f32,
        sticky_client_ids: Vec<String>,
    }
}

// æœåŠ¡å™¨å“åº”
SignalingToActr {
    target: ActrId,
    payload: Pong {}
}
```

**æµ‹è¯•ç‚¹**:
- â³ Ping/Pong å“åº”
- â³ è¶…æ—¶æ£€æµ‹
- â³ è¿æ¥ä¿æ´»
- â³ è´Ÿè½½æŒ‡æ ‡å­˜å‚¨ï¼ˆpower_reserve, mailbox_backlogï¼‰

**å®ç°å¤æ‚åº¦**: ä¸­ï¼ˆéœ€è¦å·²æ³¨å†Œçš„ Actorï¼‰

---

### 4. ä¿¡ä»¤ä¸­ç»§æµ‹è¯• â³

**åŠŸèƒ½**: éªŒè¯ Actor é—´ä¿¡ä»¤è½¬å‘

**åè®®ç»“æ„**:
```rust
// Actor A å‘é€
ActrRelay {
    to: ActrId,  // Actor B
    payload_type: Ice(Bytes) | Sdp(Bytes)
}

// æœåŠ¡å™¨è½¬å‘ç»™ Actor B
ActrRelay {
    to: ActrId,  // Actor B
    payload_type: Ice(Bytes) | Sdp(Bytes)
}
```

**æµ‹è¯•ç‚¹**:
- â³ ICE æ¶ˆæ¯è½¬å‘
- â³ SDP æ¶ˆæ¯è½¬å‘
- â³ ç›®æ ‡ä¸å­˜åœ¨å¤„ç†
- â³ ç›®æ ‡ç¦»çº¿å¤„ç†

**å®ç°å¤æ‚åº¦**: é«˜ï¼ˆéœ€è¦ä¸¤ä¸ªå·²æ³¨å†Œçš„ Actorï¼‰

---

### 5. æœåŠ¡å‘ç°æµ‹è¯• â³

**åŠŸèƒ½**: éªŒè¯æœåŠ¡æ³¨å†Œå’Œå‘ç°

**åè®®ç»“æ„**:
```rust
// å®¢æˆ·ç«¯æŸ¥è¯¢
DiscoveryRequest {
    criteria: DiscoveryCriteria
}

// æœåŠ¡å™¨å“åº”
DiscoveryResponse {
    services: Vec<ServiceInfo>
}
```

**æµ‹è¯•ç‚¹**:
- â³ æœåŠ¡æ³¨å†Œåˆ° ServiceRegistry
- â³ æœåŠ¡å‘ç°æŸ¥è¯¢
- â³ è¿‡æœŸæœåŠ¡æ¸…ç†

**å®ç°å¤æ‚åº¦**: ä¸­

---

### 6. è´Ÿè½½å‡è¡¡æµ‹è¯• â³

**åŠŸèƒ½**: éªŒè¯å¤šå› ç´ è´Ÿè½½å‡è¡¡ç®—æ³•

**æµ‹è¯•ç‚¹**:
- â³ åŠŸç‡å‚¨å¤‡æ’åº
- â³ é‚®ç®±ç§¯å‹æ’åº
- â³ å…¼å®¹æ€§è¯„åˆ†è®¡ç®—
- â³ åœ°ç†è·ç¦»è®¡ç®—
- â³ å®¢æˆ·ç«¯ç²˜æ€§ä¿æŒ

**å®ç°å¤æ‚åº¦**: ä¸­ï¼ˆå¯ä»¥ç‹¬ç«‹æµ‹è¯•ç®—æ³•ï¼‰

---

## å½“å‰å®æ–½çš„ç®€åŒ–æµ‹è¯•

ç”±äºå®Œæ•´é›†æˆæµ‹è¯•çš„å¤æ‚æ€§ï¼Œæˆ‘ä»¬å…ˆå®æ–½ä»¥ä¸‹éªŒè¯ï¼š

### âœ… é™æ€éªŒè¯ï¼ˆç¼–è¯‘æ—¶ï¼‰

```bash
# ç¼–è¯‘æ£€æŸ¥
cargo check -p signaling

# Clippy æ£€æŸ¥
cargo clippy -p signaling

# æ ¼å¼æ£€æŸ¥
cargo fmt --check -p signaling
```

### âœ… æ¨¡å—çº§å•å…ƒæµ‹è¯•

åˆ›å»ºä»¥ä¸‹å•å…ƒæµ‹è¯•ï¼š

1. **è´Ÿè½½å‡è¡¡ç®—æ³•æµ‹è¯•** (å¯ç‹¬ç«‹æµ‹è¯•)
   ```rust
   // crates/signaling/src/load_balancer.rs
   #[cfg(test)]
   mod tests {
       #[test]
       fn test_power_reserve_sorting() { }

       #[test]
       fn test_compatibility_scoring() { }

       #[test]
       fn test_geographic_distance() { }
   }
   ```

2. **æœåŠ¡æ³¨å†Œè¡¨æµ‹è¯•** (å¯ç‹¬ç«‹æµ‹è¯•)
   ```rust
   // crates/signaling/src/service_registry.rs
   #[cfg(test)]
   mod tests {
       #[test]
       fn test_service_registration() { }

       #[test]
       fn test_service_expiration() { }
   }
   ```

3. **å…¼å®¹æ€§ç¼“å­˜æµ‹è¯•** (å¯ç‹¬ç«‹æµ‹è¯•)
   ```rust
   // crates/signaling/src/compatibility_cache.rs
   #[cfg(test)]
   mod tests {
       #[test]
       fn test_exact_match_cache() { }

       #[test]
       fn test_score_calculation() { }
   }
   ```

---

## æµ‹è¯•ä¾èµ–

å®Œæ•´é›†æˆæµ‹è¯•éœ€è¦æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š

```toml
[dev-dependencies]
tokio-tungstenite = "0.27"  # WebSocket å®¢æˆ·ç«¯
```

---

## å®æ–½ä¼˜å…ˆçº§

### âœ… P0 - å·²å®Œæˆï¼ˆæ ¸å¿ƒé€»è¾‘æµ‹è¯•ï¼‰

1. âœ… **åˆ›å»ºæµ‹è¯•è®¡åˆ’æ–‡æ¡£** (æœ¬æ–‡æ¡£)
2. âœ… **æ·»åŠ è´Ÿè½½å‡è¡¡ç®—æ³•å•å…ƒæµ‹è¯•** (23 ä¸ªæµ‹è¯•ï¼Œè¦†ç›–æ‰€æœ‰æ’åºå› å­å’Œè¾¹ç•Œæƒ…å†µ)
3. âœ… **æ·»åŠ æœåŠ¡æ³¨å†Œè¡¨å•å…ƒæµ‹è¯•** (14 ä¸ªæµ‹è¯•ï¼Œè¦†ç›–æ³¨å†Œ/å‘ç°/æ³¨é”€/çŠ¶æ€æ›´æ–°)
4. âœ… **æ·»åŠ å…¼å®¹æ€§ç¼“å­˜å•å…ƒæµ‹è¯•** (5 ä¸ªæµ‹è¯•ï¼Œè¦†ç›–ç¼“å­˜æ“ä½œå’Œè¿‡æœŸæ¸…ç†)

**ç›®æ ‡è¾¾æˆ**: æ ¸å¿ƒé€»è¾‘æµ‹è¯•è¦†ç›–ç‡ > 70%ï¼Œå…± 54 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### P1 - çŸ­æœŸå®æ–½ï¼ˆ1-2 å‘¨ï¼‰

5. â³ **æ·»åŠ  WebSocket è¿æ¥æµ‹è¯•** (4-8 å°æ—¶)
   - éœ€è¦æ·»åŠ  `tokio-tungstenite` ä¾èµ–
   - åˆ›å»ºæµ‹è¯•è¾…åŠ©å·¥å…·

6. â³ **æ·»åŠ  Actor æ³¨å†Œæµç¨‹æµ‹è¯•** (4-8 å°æ—¶)
   - Mock AIS å®¢æˆ·ç«¯
   - æˆ–ä½¿ç”¨æµ‹è¯• Token

7. â³ **æ·»åŠ å¿ƒè·³å’Œä¿¡ä»¤ä¸­ç»§æµ‹è¯•** (4-6 å°æ—¶)

**ç›®æ ‡**: ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•è¦†ç›–

### P2 - é•¿æœŸå®æ–½ï¼ˆæŒç»­ï¼‰

8. â³ **å‹åŠ›æµ‹è¯•å’Œå¹¶å‘æµ‹è¯•** (8-16 å°æ—¶)
9. â³ **æ€§èƒ½åŸºå‡†æµ‹è¯•** (4-8 å°æ—¶)
10. â³ **é”™è¯¯åœºæ™¯æµ‹è¯•** (4-8 å°æ—¶)

---

## æµ‹è¯•è¿è¡Œ

### å½“å‰å¯è¿è¡Œçš„æµ‹è¯•

```bash
# ç¼–è¯‘æ£€æŸ¥
cargo check -p signaling

# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•ï¼ˆ54 ä¸ªæµ‹è¯•ï¼‰
cargo test -p signaling --lib

# è¿è¡Œç‰¹å®šæ¨¡å—çš„æµ‹è¯•
cargo test -p signaling --lib load_balancer::tests
cargo test -p signaling --lib service_registry::tests
cargo test -p signaling --lib compatibility_cache::tests

# æ ¼å¼å’Œ Clippy
cargo fmt --check -p signaling
cargo clippy -p signaling
```

**æµ‹è¯•ç»Ÿè®¡**ï¼š

| æ¨¡å— | æµ‹è¯•æ•° | è¯´æ˜ |
|------|--------|------|
| load_balancer | 23 | è´Ÿè½½å‡è¡¡ç®—æ³•ï¼ˆæ’åºã€è¿‡æ»¤ã€å…¼å®¹æ€§è¯„åˆ†ï¼‰ |
| service_registry | 14 | æœåŠ¡æ³¨å†Œã€å‘ç°ã€æ³¨é”€ã€çŠ¶æ€ç®¡ç† |
| compatibility_cache | 5 | å…¼å®¹æ€§ç¼“å­˜æ“ä½œå’Œè¿‡æœŸæ¸…ç† |
| geo | 5 | Haversine è·ç¦»è®¡ç®— |
| presence | 5 | Presence è®¢é˜…å’Œç»Ÿè®¡ |
| ais_client | 2 | AIS å®¢æˆ·ç«¯é…ç½® |
| **æ€»è®¡** | **54** | **å…¨éƒ¨é€šè¿‡** |

### æœªæ¥çš„é›†æˆæµ‹è¯•

```bash
# è¿è¡Œé›†æˆæµ‹è¯•ï¼ˆéœ€è¦å®Œæ•´å®ç°ï¼‰
cargo test -p signaling --test integration_test

# è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test -p signaling test_websocket_connection
```

---

## é£é™©è¯„ä¼°

### å½“å‰é£é™© ğŸŸ¢ â†’ ğŸŸ¡

**P0 é£é™©å·²ç¼“è§£**: æ ¸å¿ƒé€»è¾‘æµ‹è¯•å·²å®Œæˆ
- âœ… è´Ÿè½½å‡è¡¡ç®—æ³•ç»è¿‡å……åˆ†æµ‹è¯•ï¼ˆ23 ä¸ªæµ‹è¯•è¦†ç›–æ‰€æœ‰æ’åºå› å­ï¼‰
- âœ… æœåŠ¡æ³¨å†Œè¡¨é€»è¾‘ç»è¿‡éªŒè¯ï¼ˆ14 ä¸ªæµ‹è¯•è¦†ç›–å¢åˆ æ”¹æŸ¥ï¼‰
- âœ… å…¼å®¹æ€§ç¼“å­˜é€»è¾‘ç»è¿‡éªŒè¯ï¼ˆ5 ä¸ªæµ‹è¯•è¦†ç›–ç¼“å­˜æ“ä½œï¼‰

### ç¼“è§£æªæ–½ âœ…

1. âœ… **ä»£ç å®¡æŸ¥é€šè¿‡**:
   - æ¶æ„è®¾è®¡åˆç†
   - ç±»å‹ç³»ç»Ÿä¿è¯ç¼–è¯‘æœŸæ­£ç¡®æ€§
   - å‚è€ƒäº†æˆç†Ÿçš„ auxes å®ç°

2. âœ… **æ ¸å¿ƒé€»è¾‘æµ‹è¯•å®Œæˆ**:
   - âœ… è´Ÿè½½å‡è¡¡ç®—æ³•å…¨é¢æµ‹è¯•ï¼ˆå¥åº·è¿‡æ»¤ã€å¤šå› å­æ’åºã€å…¼å®¹æ€§è¯„åˆ†ï¼‰
   - âœ… æœåŠ¡æ³¨å†Œè¡¨æµ‹è¯•ï¼ˆæ³¨å†Œã€å‘ç°ã€æ³¨é”€ã€çŠ¶æ€æ›´æ–°ï¼‰
   - âœ… å…¼å®¹æ€§ç¼“å­˜æµ‹è¯•ï¼ˆç¼“å­˜æ“ä½œã€è¿‡æœŸæ¸…ç†ã€å¤§å°é™åˆ¶ï¼‰

3. â³ **æ‰‹åŠ¨æµ‹è¯•éªŒè¯**ï¼ˆå¾…å®æ–½ï¼‰:
   - ä½¿ç”¨çœŸå®å®¢æˆ·ç«¯è¿æ¥æµ‹è¯•
   - éªŒè¯åŸºæœ¬ä¿¡ä»¤æµç¨‹
   - è®°å½•æµ‹è¯•ç»“æœ

### æ®‹ç•™é£é™© ğŸŸ¡ï¼ˆP1ï¼‰

- WebSocket è¿æ¥ç®¡ç†å¯èƒ½å­˜åœ¨è¾¹ç•Œæ¡ä»¶é—®é¢˜ï¼ˆéœ€è¦é›†æˆæµ‹è¯•éªŒè¯ï¼‰
- å¹¶å‘åœºæ™¯ä¸‹çš„çŠ¶æ€åŒæ­¥é—®é¢˜ï¼ˆéœ€è¦å‹åŠ›æµ‹è¯•éªŒè¯ï¼‰
- å†…å­˜æ³„æ¼é£é™©ï¼ˆè¿æ¥æœªæ­£ç¡®æ¸…ç†ï¼‰

### å‘ç°çš„ä»£ç é—®é¢˜ï¼ˆéé˜»å¡ï¼‰

åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°ä»¥ä¸‹å®ç°é—®é¢˜ï¼ˆä¸å½±å“ P0 éƒ¨ç½²ï¼Œä½†å»ºè®®åç»­ä¿®å¤ï¼‰ï¼š

1. **ServiceRegistry æ¶ˆæ¯ç±»å‹ç´¢å¼•é‡å¤é—®é¢˜**:
   - ä½ç½®: `service_registry.rs:168-172`
   - é—®é¢˜: æ¯æ¬¡æ³¨å†ŒæœåŠ¡æ—¶ä¼šé‡å¤ push æœåŠ¡ååˆ° `message_type_index`ï¼Œå³ä½¿æœåŠ¡åå·²å­˜åœ¨
   - å½±å“: `get_message_type_stats()` è¿”å›çš„æ•°é‡å¯èƒ½ä¸å‡†ç¡®
   - å»ºè®®: æ·»åŠ å»é‡é€»è¾‘æˆ–ä½¿ç”¨ HashSet

2. **unregister_service é”™è¯¯å¤„ç†ä¸ä¸€è‡´**:
   - ä½ç½®: `service_registry.rs:408-452`
   - é—®é¢˜: æ³¨é”€ä¸å­˜åœ¨çš„æœåŠ¡åè¿”å› `Ok(())`ï¼Œåªæœ‰æœåŠ¡åå­˜åœ¨ä½† actor_id ä¸åŒ¹é…æ—¶æ‰è¿”å› `Err`
   - å½±å“: é”™è¯¯æƒ…å†µä¸‹è¿”å›æˆåŠŸï¼Œå¯èƒ½å¯¼è‡´è°ƒç”¨æ–¹è¯¯åˆ¤
   - å»ºè®®: ç»Ÿä¸€é”™è¯¯å¤„ç†é€»è¾‘

**éƒ¨ç½²å»ºè®®**:
- âœ… **å¯ä»¥è¿›è¡Œå—æ§ç¯å¢ƒéƒ¨ç½²**ï¼ˆæ ¸å¿ƒé€»è¾‘å·²éªŒè¯ï¼‰
- å¯ç”¨è¯¦ç»†æ—¥å¿—
- è®¾ç½®ç›‘æ§å‘Šè­¦
- é€æ­¥å¢åŠ è´Ÿè½½

---

## éªŒæ”¶æ ‡å‡†

### âœ… æœ€å°éªŒæ”¶ï¼ˆP0ï¼‰- å·²å®Œæˆ

- [x] è´Ÿè½½å‡è¡¡ç®—æ³•æµ‹è¯• > 80% è¦†ç›–ï¼ˆ23 ä¸ªæµ‹è¯•ï¼‰
- [x] æœåŠ¡æ³¨å†Œè¡¨æµ‹è¯• > 80% è¦†ç›–ï¼ˆ14 ä¸ªæµ‹è¯•ï¼‰
- [x] å…¼å®¹æ€§ç¼“å­˜æµ‹è¯• > 80% è¦†ç›–ï¼ˆ5 ä¸ªæµ‹è¯•ï¼‰
- [x] ç¼–è¯‘æ— è­¦å‘Š
- [x] Clippy é€šè¿‡

### å®Œæ•´éªŒæ”¶ï¼ˆP1ï¼‰

- [ ] WebSocket è¿æ¥æµ‹è¯•é€šè¿‡
- [ ] Actor æ³¨å†Œæµç¨‹æµ‹è¯•é€šè¿‡
- [ ] å¿ƒè·³æœºåˆ¶æµ‹è¯•é€šè¿‡
- [ ] ä¿¡ä»¤ä¸­ç»§æµ‹è¯•é€šè¿‡
- [ ] æœåŠ¡å‘ç°æµ‹è¯•é€šè¿‡
- [ ] ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•é€šè¿‡

---

## å®æ–½æ—¶é—´è¡¨

| ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | å®é™…æ—¶é—´ | çŠ¶æ€ |
|------|---------|---------|------|
| æµ‹è¯•è®¡åˆ’æ–‡æ¡£ | 2h | ~2h | âœ… å®Œæˆ |
| è´Ÿè½½å‡è¡¡ç®—æ³•æµ‹è¯• | 2-4h | ~1hï¼ˆå·²æœ‰æµ‹è¯•ï¼‰ | âœ… å®Œæˆ |
| æœåŠ¡æ³¨å†Œè¡¨æµ‹è¯• | 1-2h | ~2h | âœ… å®Œæˆ |
| å…¼å®¹æ€§ç¼“å­˜æµ‹è¯• | 1-2h | ~30minï¼ˆå·²æœ‰æµ‹è¯•ï¼‰ | âœ… å®Œæˆ |
| **P0 æ€»è®¡** | **6-10h** | **~5.5h** | âœ… **å·²å®Œæˆ** |
| WebSocket è¿æ¥æµ‹è¯• | 4-8h | - | â³ å»¶åè‡³ P1 |
| Actor æ³¨å†Œæµ‹è¯• | 4-8h | - | â³ å»¶åè‡³ P1 |
| å¿ƒè·³å’Œä¸­ç»§æµ‹è¯• | 4-6h | - | â³ å»¶åè‡³ P1 |
| **P1 æ€»è®¡** | **12-22h** | - | **å¾…å®æ–½** |

---

## é™„å½•ï¼šåè®®å‚è€ƒ

### SignalingEnvelope ç»“æ„

```protobuf
message SignalingEnvelope {
  required uint32 envelope_version = 1;
  required string envelope_id = 2;
  optional string reply_for = 3;

  oneof flow {
    PeerToSignaling peer_to_signaling = 10;
    SignalingToActr signaling_to_actr = 11;
    ActrToSignaling actr_to_signaling = 12;
    ActrRelay actr_relay = 13;
  }
}
```

### å®Œæ•´æ–‡æ¡£

è¯¦è§ï¼š
- `/d/actor-rtc/actr/crates/protocol/proto/signaling.proto`
- `/d/actor-rtc/actr/crates/protocol/proto/actr.proto`

---

**ç»´æŠ¤è€…**: Actrix å¼€å‘å›¢é˜Ÿ
**åˆ›å»ºæ—¶é—´**: 2025-11-06
**æ›´æ–°æ—¶é—´**: 2025-11-06
**P0 å®Œæˆ**: 2025-11-06
**ä¸‹æ¬¡å®¡æŸ¥**: å¼€å§‹ P1 é›†æˆæµ‹è¯•å‰
